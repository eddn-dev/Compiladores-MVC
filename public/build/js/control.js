const AFNS=[];function handleModal(e){switch(e.getAttribute("id")){case"modal8":handleCrearAFNBasico(e);break;case"modal9":handleUnirAFN(e);break;case"modal10":handleConcatenarAFN(e);break;case"modal11":handleAplicarCerraduraKleene(e);break;case"modal12":handleAplicarCerraduraPositiva(e);break;case"modal13":handleAplicarOpcional(e)}}function handleAFNModal(e,a){const t=e.querySelector("form"),n=t.querySelector(".modal_button.accept"),o=t.querySelector(".modal_button.cancel"),r={},l={};function c(){let e=!0;return a.fields.forEach((a=>{const t=l[a.name].value.trim(),n=r[a.name];if(n&&(n.textContent="",n.classList.remove("error")),a.validate){const o=a.validate(t,l);o&&(e=!1,n&&(n.textContent=o,n.classList.add("error")))}})),e}a.fields.forEach((e=>{l[e.name]=t.querySelector(e.selector),e.alertSelector&&(r[e.name]=t.querySelector(e.alertSelector))})),n.disabled=!0,a.populateAFNSelects&&actualizarSelectsDeAFN(l),t.addEventListener(a.validationEvent||"input",(()=>{const e=c();n.disabled=!e})),t.addEventListener("submit",(n=>{n.preventDefault();c()?(a.onSubmit(l,t),alert(a.successMessage||"Operación realizada exitosamente."),closeModal(e)):alert(a.errorMessage||"Por favor, corrige los errores antes de continuar.")})),o.addEventListener("click",(()=>{closeModal(e)}))}function handleCrearAFNBasico(e){handleAFNModal(e,{fields:[{name:"automatonId",selector:"#automaton-id",alertSelector:"#automaton-id-alert",validate:e=>e?/^[0-9]+$/.test(e)?AFNS.some((a=>a.ID_AFN===e))?"El ID ya existe. Elige otro.":null:"El ID solo puede contener números.":"El ID es obligatorio."},{name:"startSymbol",selector:"#start-symbol",alertSelector:"#start-symbol-alert",validate:e=>e?esCaracterValido(e)?null:"El símbolo de inicio debe ser un carácter válido.":"El símbolo de inicio es obligatorio."},{name:"endSymbol",selector:"#end-symbol",alertSelector:"#end-symbol-alert",validate:(e,a)=>{const t=a.startSymbol.value.trim();if(e){if(!esCaracterValido(e))return"El símbolo de final debe ser un carácter válido o estar vacío.";if(t&&t>e)return"El símbolo final no puede ser menor que el símbolo inicial (valor ASCII)."}return null}}],onSubmit:(e,a)=>{const t=e.automatonId.value.trim(),n=e.startSymbol.value.trim(),o=e.endSymbol.value.trim()||null;let r=AFN.Crear_Basico_AFN(n,o);r.ID_AFN=t;switch(a.querySelector('input[name="cerradura"]:checked').value){case"kleene":r.Cerradura_Kleene();break;case"epsilon":r.Cerradura_Positiva()}AFNS.push(r),actualizarSelectsDeAFN()},successMessage:"AFN básico creado exitosamente.",errorMessage:"Por favor, corrige los errores antes de continuar."})}function handleUnirAFN(e){handleAFNModal(e,{fields:[{name:"afnId1",selector:"#automaton-id-1",alertSelector:"#automaton-id-1-alert",validate:e=>e?null:"Selecciona un AFN."},{name:"afnId2",selector:"#automaton-id-2",alertSelector:"#automaton-id-2-alert",validate:(e,a)=>{const t=a.afnId1.value.trim();return e?e===t?"Debes seleccionar un AFN diferente.":null:"Selecciona un AFN."}}],validationEvent:"change",populateAFNSelects:!0,onSubmit:(e,a)=>{const t=e.afnId1.value,n=e.afnId2.value,o=AFNS.findIndex((e=>e.ID_AFN===t)),r=AFNS.findIndex((e=>e.ID_AFN===n)),l=AFNS[o],c=AFNS[r];l.Unir(c);switch(a.querySelector('input[name="cerradura"]:checked').value){case"kleene":l.Cerradura_Kleene();break;case"epsilon":l.Cerradura_Positiva()}AFNS.splice(r,1),actualizarSelectsDeAFN()},successMessage:"AFNs unidos exitosamente.",errorMessage:"Por favor, corrige los errores antes de continuar."})}function handleConcatenarAFN(e){handleAFNModal(e,{fields:[{name:"afnId1",selector:"#automaton-id-1",alertSelector:"#automaton-id-1-alert",validate:e=>e?null:"Selecciona un AFN."},{name:"afnId2",selector:"#automaton-id-2",alertSelector:"#automaton-id-2-alert",validate:(e,a)=>{const t=a.afnId1.value.trim();return e?e===t?"Debes seleccionar un AFN diferente.":null:"Selecciona un AFN."}}],validationEvent:"change",populateAFNSelects:!0,onSubmit:(e,a)=>{const t=e.afnId1.value,n=e.afnId2.value,o=AFNS.findIndex((e=>e.ID_AFN===t)),r=AFNS.findIndex((e=>e.ID_AFN===n)),l=AFNS[o],c=AFNS[r];l.Concatenar(c);switch(a.querySelector('input[name="cerradura"]:checked').value){case"kleene":l.Cerradura_Kleene();break;case"epsilon":l.Cerradura_Positiva()}AFNS.splice(r,1),actualizarSelectsDeAFN()},successMessage:"AFNs concatenados exitosamente.",errorMessage:"Por favor, corrige los errores antes de continuar."})}function handleAplicarCerraduraKleene(e){handleAFNModal(e,{fields:[{name:"afnId1",selector:"#automaton-id-1",alertSelector:"#automaton-id-1-alert",validate:e=>e?null:"Selecciona un AFN."}],validationEvent:"change",populateAFNSelects:!0,onSubmit:(e,a)=>{const t=e.afnId1.value,n=AFNS.findIndex((e=>e.ID_AFN===t));AFNS[n].Cerradura_Kleene(),actualizarSelectsDeAFN()},successMessage:"Cerradura de Kleene aplicada exitosamente.",errorMessage:"Por favor, corrige los errores antes de continuar."})}function handleAplicarCerraduraPositiva(e){handleAFNModal(e,{fields:[{name:"afnId1",selector:"#automaton-id-1",alertSelector:"#automaton-id-1-alert",validate:e=>e?null:"Selecciona un AFN."}],validationEvent:"change",populateAFNSelects:!0,onSubmit:(e,a)=>{const t=e.afnId1.value,n=AFNS.findIndex((e=>e.ID_AFN===t));AFNS[n].Cerradura_Positiva(),actualizarSelectsDeAFN()},successMessage:"Cerradura positiva aplicada exitosamente.",errorMessage:"Por favor, corrige los errores antes de continuar."})}function handleAplicarOpcional(e){handleAFNModal(e,{fields:[{name:"afnId1",selector:"#automaton-id-1",alertSelector:"#automaton-id-1-alert",validate:e=>e?null:"Selecciona un AFN."}],validationEvent:"change",populateAFNSelects:!0,onSubmit:(e,a)=>{const t=e.afnId1.value,n=AFNS.findIndex((e=>e.ID_AFN===t));AFNS[n].Opcional(),actualizarSelectsDeAFN()},successMessage:"Operador opcional aplicado exitosamente.",errorMessage:"Por favor, corrige los errores antes de continuar."})}function esCaracterValido(e){if(1!==e.length)return!1;const a=e.charCodeAt(0);return a>=32&&a<=126}function closeModal(e){const a=new CustomEvent("closeModal",{detail:{modal:e}});document.dispatchEvent(a)}function actualizarSelectsDeAFN(e=null){if(e){for(const a in e)if("SELECT"===e[a].tagName){const t=e[a];t.innerHTML='<option value="">Sin selección</option>',AFNS.forEach((e=>{const a=document.createElement("option");a.value=e.ID_AFN,a.textContent=e.ID_AFN,t.appendChild(a)}))}}else{document.querySelectorAll('select[name^="automaton-id"]').forEach((e=>{e.innerHTML='<option value="">Sin selección</option>',AFNS.forEach((a=>{const t=document.createElement("option");t.value=a.ID_AFN,t.textContent=a.ID_AFN,e.appendChild(t)}))}))}}document.addEventListener("modalLoaded",(function(e){handleModal(e.detail.modal)}));