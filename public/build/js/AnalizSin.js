const TOKEN={OR:10,CONCAT:20,CERRPOS:30,CERRKLEEN:40,CERROPC:50,LPAREN:60,SPACE:70,RPAREN:80,LCORCH:90,RCORCH:100,DASH:110,SIMB:120,END:0};class ExpresionRegular{constructor(e="",t=null){this.ER=e,this.AL=new AnalizadorLexico(e,t),this.result=null,this.tree=new Nodo("E")}getTree(){return this.tree}getResult(){return this.result}getER(){return this.ER}setER(e){this.ER=e,this.AL.setSigma(e)}parse(){const e=new AFN,t=[];if(this.E(e,t)){this.tree.children=t;return this.AL.yylex()===TOKEN.END&&(this.result=e,!0)}return!1}E(e,t){const s=[];if(this.T(e,s)){t.push(new Nodo("T",s));const n=[];if(this.Ep(e,n))return t.push(new Nodo("E'",n)),!0}return!1}Ep(e,t){if(this.AL.yylex()===TOKEN.OR){t.push(new Nodo("|"));const s=new AFN,n=[];if(this.T(s,n)){t.push(new Nodo("T",n));const r=[];if(this.Ep(s,r))return t.push(new Nodo("E'",r)),e.Unir(s),!0}return!1}return this.AL.undoToken(),!0}T(e,t){const s=[];if(this.C(e,s)){t.push(new Nodo("C",s));const n=[];if(this.Tp(e,n))return t.push(new Nodo("T'",n)),!0}return!1}Tp(e,t){if(this.AL.yylex()===TOKEN.CONCAT){t.push(new Nodo("&"));const s=new AFN,n=[];if(this.C(s,n)){t.push(new Nodo("C",n));const r=[];if(this.Tp(s,r))return t.push(new Nodo("T'",r)),e.Concatenar(s),!0}return!1}return this.AL.undoToken(),!0}C(e,t){const s=[];if(this.F(e,s)){t.push(new Nodo("F",s));const n=[];if(this.Cp(e,n))return t.push(new Nodo("C'",n)),!0}return!1}Cp(e,t){switch(this.AL.yylex()){case TOKEN.CERRPOS:return t.push(new Nodo("+")),!!this.Cp(e,[])&&(e.Cerradura_Positiva(),!0);case TOKEN.CERRKLEEN:return t.push(new Nodo("*")),!!this.Cp(e,[])&&(e.Cerradura_Kleene(),!0);case TOKEN.CERROPC:return t.push(new Nodo("?")),!!this.Cp(e,[])&&(e.Opcional(),!0);default:return this.AL.undoToken(),!0}}F(e,t){switch(this.AL.yylex()){case TOKEN.LPAREN:t.push(new Nodo("("));const s=[];if(this.E(e,s)){t.push(new Nodo("E",s));if(this.AL.yylex()===TOKEN.RPAREN)return t.push(new Nodo(")")),!0}return!1;case TOKEN.LCORCH:t.push(new Nodo("["));const n=this.AL.yylex();if(n===TOKEN.SIMB||n===TOKEN.SPACE){const s=this.AL.getLexema(),n="\\"===s[0]?s[1]:s[0];t.push(new Nodo(n));if(this.AL.yylex()===TOKEN.DASH){t.push(new Nodo("-"));const s=this.AL.yylex();if(s===TOKEN.SIMB||s===TOKEN.SPACE){const s=this.AL.getLexema(),r="\\"===s[0]?s[1]:s[0];t.push(new Nodo(r));if(this.AL.yylex()===TOKEN.RCORCH){t.push(new Nodo("]"));const s=AFN.Crear_Basico_AFN(n,r);return Object.assign(e,s),!0}}}}return!1;case TOKEN.SIMB:case TOKEN.SPACE:const r=this.AL.getLexema(),o="\\"===r[0]?r[1]:r[0];t.push(new Nodo(o));const i=AFN.Crear_Basico_AFN(o);return Object.assign(e,i),!0;default:return!1}}}const TOKENCALC={PLUS:10,MINUS:20,PROD:30,DIV:40,LPAREN:50,RPAREN:60,SPACE:70,NUM:80,END:0};function Nodo(e,t){this.name=e,this.children=t||[]}class Calculadora{constructor(e="",t=null){this.AL=new AnalizadorLexico(e,t),this.resultado=0,this.tree=null}setSigma(e){this.AL.setSigma(e)}parse(){const e={val:0},t=this.E(e);return!(!t.val||this.AL.yylex()!==TOKENCALC.END)&&(this.resultado=e.val,this.tree=t.tree,!0)}E(e){const t={val:0},s=new Nodo("E",[]),n=this.T(t);if(n.val){e.val=t.val,s.children.push(n.tree);const r=this.Ep(e);return r.val&&s.children.push(r.tree),{val:!0,tree:s}}return{val:!1,tree:s}}Ep(e){const t=this.AL.yylex(),s=new Nodo("E'",[]),n={val:0};if(t===TOKENCALC.PLUS||t===TOKENCALC.MINUS){const r=this.T(n);if(r.val){e.val+=t===TOKENCALC.PLUS?n.val:-n.val,s.children.push(r.tree,new Nodo(t===TOKENCALC.PLUS?"+":"-"));const o=this.Ep(e);return o.val&&s.children.push(o.tree),{val:!0,tree:s}}return{val:!1,tree:s}}return this.AL.undoToken(),s.children.push(new Nodo("ε")),{val:!0,tree:s}}T(e){const t={val:0},s=new Nodo("T",[]),n=this.F(t);if(n.val){e.val=t.val,s.children.push(n.tree);const r=this.Tp(e);return r.val&&s.children.push(r.tree),{val:!0,tree:s}}return{val:!1,tree:s}}Tp(e){const t=this.AL.yylex(),s=new Nodo("T'",[]),n={val:0};if(t===TOKENCALC.PROD||t===TOKENCALC.DIV){const r=this.F(n);if(r.val){e.val=t===TOKENCALC.PROD?e.val*n.val:e.val/n.val,s.children.push(r.tree,new Nodo(t===TOKENCALC.PROD?"*":"/"));const o=this.Tp(e);return o.val&&s.children.push(o.tree),{val:!0,tree:s}}return{val:!1,tree:s}}return this.AL.undoToken(),s.children.push(new Nodo("ε")),{val:!0,tree:s}}F(e){const t=this.AL.yylex(),s=new Nodo("F",[]);if(t===TOKENCALC.LPAREN){const t=this.E(e);return t.val&&this.AL.yylex()===TOKENCALC.RPAREN?(s.children.push(new Nodo("("),t.tree,new Nodo(")")),{val:!0,tree:s}):{val:!1,tree:s}}return t===TOKENCALC.NUM?(e.val=parseFloat(this.AL.getLexema()),s.children.push(new Nodo("num",[new Nodo(`${e.val}`)])),{val:!0,tree:s}):(this.AL.undoToken(),{val:!1,tree:s})}recorrerPostorden(e){let t="";if(e.children)for(const s of e.children)t+=this.recorrerPostorden(s)+" ";return"E"!==e.name&&"E'"!==e.name&&"T"!==e.name&&"T'"!==e.name&&"F"!==e.name&&"ε"!==e.name&&"num"!==e.name&&"("!==e.name&&")"!==e.name&&(t+=e.name+" "),t.trim()}getPostfijo(){return this.tree?this.recorrerPostorden(this.tree).trim():""}getResultado(){return this.resultado}}