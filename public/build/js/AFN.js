class AFN{constructor(){this.Edo_Inicial=null,this.Estados=new Set,this.Alfabeto=new Set,this.Edos_Acept=new Set,this.ID_AFN=AFN.Cant_AFN,AFN.Cant_AFN+=1,this.matrizTransicionAFD=null}static Cant_AFN=0;static Crear_Basico_AFN(i,o=null){let s=new AFN,t=new Estado,n=new Estado;if(null===o){let o=new Transicion(i,i,n);t.Transiciones.add(o),s.Alfabeto.add(i)}else{o<i&&([i,o]=[o,i]);let a=new Transicion(i,o,n);t.Transiciones.add(a);for(let t=i.charCodeAt(0);t<=o.charCodeAt(0);t++)s.Alfabeto.add(String.fromCharCode(t))}return n.Edo_Acept=!0,s.Edo_Inicial=t,s.Edos_Acept.add(n),s.Estados.add(t),s.Estados.add(n),s}Unir(i){let o=new Estado,s=new Estado;o.Transiciones.add(new Transicion(Epsilon,Epsilon,this.Edo_Inicial)),o.Transiciones.add(new Transicion(Epsilon,Epsilon,i.Edo_Inicial));for(let i of this.Edos_Acept)i.Transiciones.add(new Transicion(Epsilon,Epsilon,s)),i.Edo_Acept=!1;for(let o of i.Edos_Acept)o.Transiciones.add(new Transicion(Epsilon,Epsilon,s)),o.Edo_Acept=!1;return s.Edo_Acept=!0,this.Edo_Inicial=o,this.Edos_Acept.clear(),this.Edos_Acept.add(s),this.Estados=new Set([...this.Estados,...i.Estados]),this.Estados.add(o),this.Estados.add(s),this.Alfabeto=new Set([...this.Alfabeto,...i.Alfabeto]),this}Concatenar(i){for(let o of this.Edos_Acept)o.Transiciones=new Set([...o.Transiciones,...i.Edo_Inicial.Transiciones]),o.Edo_Acept=!1;return this.Estados=new Set([...this.Estados,...i.Estados]),this.Edos_Acept.clear(),this.Edos_Acept=new Set([...i.Edos_Acept]),this.Alfabeto=new Set([...this.Alfabeto,...i.Alfabeto]),this}Cerradura_Positiva(){let i=new Estado,o=new Estado;i.Transiciones.add(new Transicion(Epsilon,Epsilon,this.Edo_Inicial));for(let i of this.Edos_Acept)i.Transiciones.add(new Transicion(Epsilon,Epsilon,o)),i.Transiciones.add(new Transicion(Epsilon,Epsilon,this.Edo_Inicial)),i.Edo_Acept=!1;return o.Edo_Acept=!0,this.Edo_Inicial=i,this.Edos_Acept.clear(),this.Edos_Acept.add(o),this.Estados.add(i),this.Estados.add(o),this}Cerradura_Kleene(){let i=new Estado,o=new Estado;i.Transiciones.add(new Transicion(Epsilon,Epsilon,this.Edo_Inicial));for(let i of this.Edos_Acept)i.Transiciones.add(new Transicion(Epsilon,Epsilon,o)),i.Transiciones.add(new Transicion(Epsilon,Epsilon,this.Edo_Inicial)),i.Edo_Acept=!1;return i.Transiciones.add(new Transicion(Epsilon,Epsilon,o)),o.Edo_Acept=!0,this.Edo_Inicial=i,this.Edos_Acept.clear(),this.Edos_Acept.add(o),this.Estados.add(i),this.Estados.add(o),this}Opcional(){let i=new Estado,o=new Estado;i.Transiciones.add(new Transicion(Epsilon,Epsilon,this.Edo_Inicial)),i.Transiciones.add(new Transicion(Epsilon,Epsilon,o));for(let i of this.Edos_Acept)i.Transiciones.add(new Transicion(Epsilon,Epsilon,o)),i.Edo_Acept=!1;return o.Edo_Acept=!0,this.Edo_Inicial=i,this.Edos_Acept.clear(),this.Edos_Acept.add(o),this.Estados.add(i),this.Estados.add(o),this}static Cerradura_Epsilon(i){let o=new Set,s=[];for(s.push(i);s.length>0;){let i=s.pop();if(!o.has(i)){o.add(i);for(let t of i.Transiciones)t.Simbolo_Inferior===Epsilon&&t.Simbolo_Superior===Epsilon&&(o.has(t.Edo_Destino)||s.push(t.Edo_Destino))}}return o}static Cerradura(i){let o=new Set;for(let s of i)o=new Set([...o,...AFN.Cerradura_Epsilon(s)]);return o}static Mover(i,o){let s=new Set;for(let t of i)for(let i of t.Transiciones)i.Simbolo_Inferior<=o&&o<=i.Simbolo_Superior&&s.add(i.Edo_Destino);return s}static ir_a(i,o){let s=AFN.Mover(i,o);return AFN.Cerradura(s)}static UnirAFNs(i){if(0===i.length)throw new Error("No se proporcionaron AFNs para unir.");let o=new AFN,s=new Estado;for(let t of i){let i=new Transicion(Epsilon,Epsilon,t.Edo_Inicial);s.Transiciones.add(i),o.Estados=new Set([...o.Estados,...t.Estados]),o.Alfabeto=new Set([...o.Alfabeto,...t.Alfabeto]),o.Edos_Acept=new Set([...o.Edos_Acept,...t.Edos_Acept])}return o.Edo_Inicial=s,o.Estados.add(s),o}convertirAFD(){const i=new Map,o=[];let s=0;this.matrizTransicionAFD=[];const t=AFN.Cerradura_Epsilon(this.Edo_Inicial),n=[...t].map((i=>i.Id_Edo)).sort().join(","),a=new ConjuntoDeEstados(t,s++);for(i.set(n,a),o.push(a);o.length>0;){const t=o.shift();this.matrizTransicionAFD[t.Id]||(this.matrizTransicionAFD[t.Id]=Array(257).fill(-1));for(let n=0;n<256;n++){const a=String.fromCharCode(n);if(!this.Alfabeto.has(a))continue;const e=AFN.ir_a(t.Estados,a);if(0===e.size)continue;const r=AFN.Cerradura(e);if(0===r.size)continue;const d=[...r].map((i=>i.Id_Edo)).sort().join(",");let c;i.has(d)?c=i.get(d):(c=new ConjuntoDeEstados(r,s++),i.set(d,c),o.push(c),this.matrizTransicionAFD[c.Id]||(this.matrizTransicionAFD[c.Id]=Array(257).fill(-1))),this.matrizTransicionAFD[t.Id][n]=c.Id}this.matrizTransicionAFD[t.Id][256]=t.Token}}imprimirMatrizAFD(){console.log("Tabla de TransiciÃ³n del AFD:");["Estado"].concat(Array.from({length:256},((i,o)=>String.fromCharCode(o))),["Token"]);const i=this.matrizTransicionAFD.map(((i,o)=>{const s=i.slice(0,256),t=i[256];return[o].concat(s,t)}));console.table(i)}generarContenidoArchivo(){let i="";for(let o=0;o<this.matrizTransicionAFD.length;o++){const s=this.matrizTransicionAFD[o];if(!s)continue;i+=[o.toString()].concat(s.map((i=>i.toString()))).join(",")+"\n"}return i}}async function iniciarDescarga(i,o){const s={suggestedName:o,types:[{description:"Archivo de texto",accept:{"text/plain":[".txt"]}}]};try{const o=await window.showSaveFilePicker(s),t=await o.createWritable();await t.write(i),await t.close(),mostrarNotificacion("Archivo guardado exitosamente.","success")}catch(i){"AbortError"!==i.name?(console.error("Error al guardar el archivo:",i),mostrarNotificacion("Error al guardar el archivo: ","error")):console.log("Guardado de archivo cancelado por el usuario.")}}