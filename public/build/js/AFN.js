class AFN{constructor(){this.Edo_Inicial=null,this.Estados=new Set,this.Alfabeto=new Set,this.Edos_Acept=new Set,this.ID_AFN=AFN.Cant_AFN,AFN.Cant_AFN+=1,this.matrizTransicionAFD=null}static Cant_AFN=0;static Crear_Basico_AFN(o,i=null){let s=new AFN,t=new Estado,n=new Estado;if(null===i){let i=new Transicion(o,o,n);t.Transiciones.add(i),s.Alfabeto.add(o)}else{i<o&&([o,i]=[i,o]);let e=new Transicion(o,i,n);t.Transiciones.add(e);for(let t=o.charCodeAt(0);t<=i.charCodeAt(0);t++)s.Alfabeto.add(String.fromCharCode(t))}return n.Edo_Acept=!0,s.Edo_Inicial=t,s.Edos_Acept.add(n),s.Estados.add(t),s.Estados.add(n),s}Unir(o){let i=new Estado,s=new Estado;i.Transiciones.add(new Transicion(Epsilon,Epsilon,this.Edo_Inicial)),i.Transiciones.add(new Transicion(Epsilon,Epsilon,o.Edo_Inicial));for(let o of this.Edos_Acept)o.Transiciones.add(new Transicion(Epsilon,Epsilon,s)),o.Edo_Acept=!1;for(let i of o.Edos_Acept)i.Transiciones.add(new Transicion(Epsilon,Epsilon,s)),i.Edo_Acept=!1;return s.Edo_Acept=!0,this.Edo_Inicial=i,this.Edos_Acept.clear(),this.Edos_Acept.add(s),this.Estados=new Set([...this.Estados,...o.Estados]),this.Estados.add(i),this.Estados.add(s),this.Alfabeto=new Set([...this.Alfabeto,...o.Alfabeto]),this}Concatenar(o){const i=Math.max(...Array.from(this.Estados).map((o=>o.Id_Edo)))+1,s=new Map;o.Estados.forEach((o=>{const t=o.Id_Edo+i,n=new Estado;n.Id_Edo=t,n.Edo_Acept=o.Edo_Acept,n.Token=o.Token,n.Transiciones=new Set,s.set(o,n)})),o.Estados.forEach((o=>{const i=s.get(o);o.Transiciones.forEach((o=>{const t=s.get(o.Edo_Destino),n=new Transicion(o.Simbolo_Inferior,o.Simbolo_Superior,t);i.Transiciones.add(n)}))})),o.Edo_Inicial=s.get(o.Edo_Inicial),o.Edos_Acept=new Set([...o.Edos_Acept].map((o=>s.get(o))));for(let i of this.Edos_Acept)i.Edo_Acept=!1,i.Transiciones.add(new Transicion(Epsilon,Epsilon,o.Edo_Inicial));return this.Edos_Acept=new Set([...o.Edos_Acept]),this.Estados=new Set([...this.Estados,...s.values()]),this.Alfabeto=new Set([...this.Alfabeto,...o.Alfabeto]),this}Cerradura_Positiva(){let o=new Estado,i=new Estado;o.Transiciones.add(new Transicion(Epsilon,Epsilon,this.Edo_Inicial));for(let o of this.Edos_Acept)o.Transiciones.add(new Transicion(Epsilon,Epsilon,i)),o.Transiciones.add(new Transicion(Epsilon,Epsilon,this.Edo_Inicial)),o.Edo_Acept=!1;return i.Edo_Acept=!0,this.Edo_Inicial=o,this.Edos_Acept.clear(),this.Edos_Acept.add(i),this.Estados.add(o),this.Estados.add(i),this}Cerradura_Kleene(){let o=new Estado,i=new Estado;o.Transiciones.add(new Transicion(Epsilon,Epsilon,this.Edo_Inicial));for(let o of this.Edos_Acept)o.Transiciones.add(new Transicion(Epsilon,Epsilon,i)),o.Transiciones.add(new Transicion(Epsilon,Epsilon,this.Edo_Inicial)),o.Edo_Acept=!1;return o.Transiciones.add(new Transicion(Epsilon,Epsilon,i)),i.Edo_Acept=!0,this.Edo_Inicial=o,this.Edos_Acept.clear(),this.Edos_Acept.add(i),this.Estados.add(o),this.Estados.add(i),this}Opcional(){let o=new Estado,i=new Estado;o.Transiciones.add(new Transicion(Epsilon,Epsilon,this.Edo_Inicial)),o.Transiciones.add(new Transicion(Epsilon,Epsilon,i));for(let o of this.Edos_Acept)o.Transiciones.add(new Transicion(Epsilon,Epsilon,i)),o.Edo_Acept=!1;return i.Edo_Acept=!0,this.Edo_Inicial=o,this.Edos_Acept.clear(),this.Edos_Acept.add(i),this.Estados.add(o),this.Estados.add(i),this}static Cerradura_Epsilon(o){let i=new Set,s=[];for(s.push(o);s.length>0;){let o=s.pop();if(!i.has(o)){i.add(o);for(let t of o.Transiciones)t.Simbolo_Inferior===Epsilon&&t.Simbolo_Superior===Epsilon&&(i.has(t.Edo_Destino)||s.push(t.Edo_Destino))}}return i}static Cerradura(o){let i=new Set;for(let s of o)i=new Set([...i,...AFN.Cerradura_Epsilon(s)]);return i}static Mover(o,i){let s=new Set;for(let t of o)for(let o of t.Transiciones)o.Simbolo_Inferior<=i&&i<=o.Simbolo_Superior&&s.add(o.Edo_Destino);return s}static ir_a(o,i){let s=AFN.Mover(o,i);return AFN.Cerradura(s)}static UnirAFNs(o){if(0===o.length)throw new Error("No se proporcionaron AFNs para unir.");let i=new AFN,s=new Estado;for(let t of o){let o=new Transicion(Epsilon,Epsilon,t.Edo_Inicial);s.Transiciones.add(o),i.Estados=new Set([...i.Estados,...t.Estados]),i.Alfabeto=new Set([...i.Alfabeto,...t.Alfabeto]),i.Edos_Acept=new Set([...i.Edos_Acept,...t.Edos_Acept])}return i.Edo_Inicial=s,i.Estados.add(s),i}convertirAFD(){const o=new Map,i=[];let s=0;this.matrizTransicionAFD=[];const t=AFN.Cerradura_Epsilon(this.Edo_Inicial),n=[...t].map((o=>o.Id_Edo)).sort().join(","),e=new ConjuntoDeEstados(t,s++);for(o.set(n,e),i.push(e);i.length>0;){const t=i.shift();this.matrizTransicionAFD[t.Id]||(this.matrizTransicionAFD[t.Id]=Array(257).fill(-1));for(let n=0;n<256;n++){const e=String.fromCharCode(n);if(!this.Alfabeto.has(e))continue;const a=AFN.ir_a(t.Estados,e);if(0===a.size)continue;const r=AFN.Cerradura(a);if(0===r.size)continue;const d=[...r].map((o=>o.Id_Edo)).sort().join(",");let c;o.has(d)?c=o.get(d):(c=new ConjuntoDeEstados(r,s++),o.set(d,c),i.push(c),this.matrizTransicionAFD[c.Id]||(this.matrizTransicionAFD[c.Id]=Array(257).fill(-1))),this.matrizTransicionAFD[t.Id][n]=c.Id}this.matrizTransicionAFD[t.Id][256]=t.Token}}clone(){const o=new AFN,i=new Map;return this.Estados.forEach((s=>{const t=new Estado;t.Edo_Acept=s.Edo_Acept,t.Token=s.Token,i.set(s,t),o.Estados.add(t)})),this.Estados.forEach((o=>{const s=i.get(o);o.Transiciones.forEach((o=>{const t=i.get(o.Edo_Destino),n=new Transicion(o.Simbolo_Inferior,o.Simbolo_Superior,t);s.Transiciones.add(n)}))})),o.Edo_Inicial=i.get(this.Edo_Inicial),this.Edos_Acept.forEach((s=>{o.Edos_Acept.add(i.get(s))})),o.Alfabeto=new Set(this.Alfabeto),o}imprimirMatrizAFD(){console.log("Tabla de TransiciÃ³n del AFD:");["Estado"].concat(Array.from({length:256},((o,i)=>String.fromCharCode(i))),["Token"]);const o=this.matrizTransicionAFD.map(((o,i)=>{const s=o.slice(0,256),t=o[256];return[i].concat(s,t)}));console.table(o)}generarContenidoArchivo(){let o="";for(let i=0;i<this.matrizTransicionAFD.length;i++){const s=this.matrizTransicionAFD[i];if(!s)continue;o+=[i.toString()].concat(s.map((o=>o.toString()))).join(",")+"\n"}return o}convertirACytoscape(){const o=[];return this.Estados.forEach((i=>{const s=[];i===this.Edo_Inicial&&s.push("estadoInicial"),this.Edos_Acept.has(i)&&s.push("estadoAceptacion"),0===s.length&&s.push("estadoNormal"),o.push({data:{id:`estado_${i.Id_Edo}`,label:`${i.Id_Edo}`,classes:s.join(" ")}})})),this.Estados.forEach((i=>{i.Transiciones.forEach((s=>{let t;t=s.Simbolo_Inferior===s.Simbolo_Superior?`${s.Simbolo_Inferior}`:`${s.Simbolo_Inferior}-${s.Simbolo_Superior}`,o.push({data:{id:`transicion_${i.Id_Edo}_${s.Edo_Destino.Id_Edo}_${t}`,source:`estado_${i.Id_Edo}`,target:`estado_${s.Edo_Destino.Id_Edo}`,label:t}})}))})),o}}async function iniciarDescarga(o,i){const s={suggestedName:i,types:[{description:"Archivo de texto",accept:{"text/plain":[".txt"]}}]};try{const i=await window.showSaveFilePicker(s),t=await i.createWritable();await t.write(o),await t.close(),mostrarNotificacion("Archivo guardado exitosamente.","success")}catch(o){"AbortError"!==o.name?(console.error("Error al guardar el archivo:",o),mostrarNotificacion("Error al guardar el archivo: ","error")):console.log("Guardado de archivo cancelado por el usuario.")}}